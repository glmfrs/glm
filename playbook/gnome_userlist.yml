---
# Gnome: Disable the user list
# https://help.gnome.org/admin/system-admin-guide/stable/login-userlist-disable.html.en

- name: Gnome creation fichier gdm
  copy:
    dest: /etc/dconf/profile/gdm
    owner: root
    group: root
    mode: 0644
    content: |
      user-db:user
      system-db:gdm
      file-db:/usr/share/gdm/greeter-dconf-defaults

- name: Gnome creation du repertoire
  file:
    path: /etc/dconf/db/gdm.d
    state: directory
    mode: 0755

- name: Gnome creation fichier login-screen
  copy:
    dest: /etc/dconf/db/gdm.d/00-login-screen
    owner: root
    group: root
    mode: 0644
    content: |
      [org/gnome/login-screen]
      disable-user-list=true

- name: Gnome dconf mise a jour
  command: /usr/bin/dconf update

- name: Gnome redemarrage du service
  systemd:
    name: gdm.service
    state: restarted
    enabled: yes
    masked: no
    daemon_reload: yes